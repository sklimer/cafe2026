ТЕХНИЧЕСКОЕ ЗАДАНИЕ: Админ-панель для системы ресторанов
1. Общее описание
1.1. Назначение
Веб-приложение для администраторов и менеджеров ресторанов, позволяющее управлять:

Ресторанами, филиалами, меню, товарами, категориями, тегами, опциями

Заказами (просмотр, изменение статуса, отмена)

Пользователями (клиентами)

Акциями, промокодами, бонусной системой

Рассылками

Аналитикой и отчетностью

1.2. Целевая аудитория
Суперадминистраторы (владельцы сети)

Администраторы ресторанов

Менеджеры заказов

Контент-менеджеры (меню, акции)

1.3. Технологический стек
Backend: Django 4.x + Django REST Framework

Frontend: React 18 + TypeScript (отдельное приложение)

База данных: PostgreSQL

Стили: Tailwind CSS

Графики: Chart.js / Recharts

Таблицы: React Table / AG Grid

Формы: React Hook Form + Zod

2. Структура админ-панели
2.1. Модули и разделы
2.1.1. Дашборд (Dashboard)
Статистика за сегодня: заказы, выручка, новые пользователи

Графики за неделю/месяц по ключевым метрикам

Последние заказы с быстрыми действиями

Предупреждения (мало товаров, проблемы с заказами)

Быстрые действия (создать заказ, добавить товар и т.д.)

2.1.2. Управление ресторанами
Список ресторанов с фильтрами и поиском

Создание/редактирование ресторана:

Основная информация (название, описание, лого, обложка)

Контактная информация

Юридическая информация (для документов)

Настройки валюты, языка, часового пояса

Управление филиалами ресторана:

Адрес, геолокация, контакты

График работы (для заказов и доставки)

Настройки заказов (минимальная сумма, время приготовления)

Настройки доставки (стоимость, радиус, зоны)

Способы оплаты

2.1.3. Управление меню (каталогом)
Категории: древовидная структура, порядок отображения

Товары:

Основная информация (название, описание, цена, себестоимость)

Изображения, видео

Характеристики (вес, калории, БЖУ)

Флаги (новинка, популярное, вегетарианское и т.д.)

Настройки отображения (порядок, SEO)

Управление наличием (остатки, unlimited)

Теги: создание и управление тегами, назначение товарам

Опции товаров:

Создание опций (тип: одиночный/множественный выбор, boolean)

Значения опций с наценкой

Назначение опций товарам

2.1.4. Управление заказами
Список заказов с расширенными фильтрами (статус, тип, дата, ресторан)

Детали заказа:

Информация о клиенте

Состав заказа с опциями

Адрес доставки / филиал самовывоза

История статусов

Комментарии, способ оплаты

Быстрое изменение статуса (подтвердить, начать готовить, отправить на доставку и т.д.)

Массовые операции (подтверждение, отмена)

Экспорт заказов (CSV, Excel)

2.1.5. Управление клиентами (CRM)
Список пользователей с фильтрами (активность, кол-во заказов)

Детальная информация о пользователе:

Telegram данные

Контактная информация

История заказов

Бонусный баланс

Реферальная информация

Массовые действия (рассылка, блокировка)

Сегментация пользователей

2.1.6. Бонусная система и промокоды
Правила начисления бонусов:

Типы правил (регистрация, первый заказ, день рождения и т.д.)

Условия и сумма начисления

Ограничения (срок, количество использований)

Промокоды:

Создание промокодов (фиксированная скидка, процент, бесплатная доставка)

Ограничения (мин. сумма, только для новых и т.д.)

Отслеживание использований

Кешбек: настройка процента кешбека от суммы заказа

2.1.7. Акции и маркетинг
Создание и управление акциями:

Типы акций (скидка, подарок, комбо)

Условия участия

Визуальное оформление (изображения, баннеры)

Таргетирование (категории, товары, пользователи)

Управление рассылками:

Создание рассылок (Telegram, email, SMS)

Шаблоны сообщений

Отслеживание статистики (открытия, клики)

2.1.8. Аналитика и отчеты
Аналитика в реальном времени:

Ключевые метрики (заказы, выручка, конверсия)

Графики по периодам

Топ товаров, категорий, ресторанов

Отчеты:

Отчет по продажам (детализация по товарам, категориям)

Отчет по пользователям (активность, LTV)

Финансовые отчеты

Экспорт отчетов

2.1.9. Настройки системы
Глобальные настройки (валюты, единицы измерения, комиссии)

Настройки уведомлений (шаблоны, триггеры)

Интеграции (платежные системы, SMS, email)

Роли и права доступа (разграничение прав для разных администраторов)

2.2. Интерфейс и UX
2.2.1. Основные принципы
Dashboard-first: важнейшая информация на дашборде

Quick actions: быстрые действия для частых операций

Bulk operations: массовые операции там, где это необходимо

Real-time updates: обновление статусов заказов в реальном времени

Keyboard shortcuts: горячие клавиши для эффективной работы

2.2.2. Дизайн и стили
Чистый, минималистичный интерфейс

Адаптивный дизайн (работа на планшетах)

Темная/светлая тема

Цветовая кодировка статусов (заказы, товары и т.д.)

3. Детальные требования к интерфейсу
3.1. Дашборд
text
┌─────────────────────────────────────────────────────────────────────┐
│ Лого │ [Поиск]                              [Уведомления] [Профиль] │
├─────────────────────────────────────────────────────────────────────┤
│ 🏠 Дашборд │ 📦 Заказы │ 🍔 Меню │ 👥 Клиенты │ 📊 Аналитика      │
├─────────────────────────────────────────────────────────────────────┤
│                                                                     │
│  Сегодня                                                           │
│  ┌────────────┐ ┌────────────┐ ┌────────────┐ ┌────────────┐      │
│  │   150      │ │ 75,000₽    │ │    12      │ │   45%      │      │
│  │  Заказов   │ │  Выручка   │ │  Клиентов  │ │  Наполн.   │      │
│  └────────────┘ └────────────┘ └────────────┘ └────────────┘      │
│                                                                     │
│  Выручка за неделю                                                  │
│  ┌──────────────────────────────────────────────────────────────┐  │
│  │                                                              │  │
│  │                    График                                    │  │
│  │                                                              │  │
│  └──────────────────────────────────────────────────────────────┘  │
│                                                                     │
│  Последние заказы                    Популярные товары             │
│  ┌────────────────────────────┐ ┌────────────────────────────┐     │
│  │ #001234 • 1,250₽ • Доставка│ │ 1. Пицца Маргарита         │     │
│  │ #001233 • 850₽ • Самовывоз │ │ 2. Бургер Чизбургер        │     │
│  │ #001232 • 2,100₽ • Доставка│ │ 3. Кофе Латте              │     │
│  └────────────────────────────┘ └────────────────────────────┘     │
│                                                                     │
│  Быстрые действия                                                   │
│  [ Создать заказ ] [ Добавить товар ] [ Создать рассылку ]         │
└─────────────────────────────────────────────────────────────────────┘
3.2. Список заказов с расширенными фильтрами
text
┌─────────────────────────────────────────────────────────────────────┐
│ 🏠 Дашборд │ 📦 Заказы │ 🍔 Меню │ 👥 Клиенты │ 📊 Аналитика      │
├─────────────────────────────────────────────────────────────────────┤
│ Заказы (1,234)                                                      │
│ ┌────────────────────────────────────────────────────────────────┐ │
│ │ [Все] [Ожидают] [Готовятся] [Доставляются] [Завершены]        │ │
│ │ [ ] [ ] [ ] [ ] [ ]                                           │ │
│ │ ┌────────────────────────────────────────────────────────────┐ │ │
│ │ │ 🔍 Поиск по номеру, клиенту, телефону...                  │ │ │
│ │ └────────────────────────────────────────────────────────────┘ │ │
│ │                                                                 │ │
│ │ ┌───┬──────────┬──────────┬────────────┬─────────┬──────────┐  │ │
│ │ │   │ №        │ Клиент   │ Сумма      │ Статус  │ Дата    │  │ │
│ │ ├───┼──────────┼──────────┼────────────┼─────────┼──────────┤  │ │
│ │ │ ◻ │ #001234  │ Иван И.  │ 1,250₽    │ 🟡      │ 12.01    │  │ │
│ │ │ ◻ │ #001233  │ Анна С.  │ 850₽      │ 🟢      │ 12.01    │  │ │
│ │ └───┴──────────┴──────────┴────────────┴─────────┴──────────┘  │ │
│ │                                                                 │ │
│ │ Страницы: 1 2 3 ... 10                         Записей: 50     │ │
│ └────────────────────────────────────────────────────────────────┘ │
│                                                                     │
│ Выделено: 2 заказа [Подтвердить] [Отменить] [Экспорт]              │
└─────────────────────────────────────────────────────────────────────┘
3.3. Детали заказа
text
┌─────────────────────────────────────────────────────────────────────┐
│ 🏠 Дашборд │ 📦 Заказы │ 🍔 Меню │ 👥 Клиенты │ 📊 Аналитика      │
├─────────────────────────────────────────────────────────────────────┤
│ Заказ #001234                                                       │
│ ┌────────────────────────────────────────────────────────────────┐ │
│ │ Статус: 🟡 Подтвержден                                         │ │
│ │ ────●────●────○────○────○                                      │ │
│ │     Создан Подтверждён Готовится Доставляется Доставлен        │ │
│ │                                                                 │ │
│ │ Информация о клиенте:                                          │ │
│ │   Иван Иванов • @ivanov • +7 (999) 123-45-67                   │ │
│ │   Заказов: 12 • Сумма: 25,000₽                                 │ │
│ │                                                                 │ │
│ │ Состав заказа:                                                 │ │
│ │   ┌────────────────────────────────────────────────────────┐   │ │
│ │   │ 🍕 Пицца Маргарита ×1                        550₽      │   │ │
│ │   │   Размер: 30см, Сырный бортик                          │   │ │
│ │   │ ☕ Кофе латте ×2                               300₽     │   │ │
│ │   │   Молоко: кокосовое                                   │   │ │
│ │   └────────────────────────────────────────────────────────┘   │ │
│ │                                                                 │ │
│ │ Адрес доставки:                                                 │ │
│ │   ул. Примерная, 10, кв. 25                                    │ │
│ │   Курьер: Иван +7 (999) 123-45-67                              │ │
│ │   Время: 18:30-18:45                                           │ │
│ │                                                                 │ │
│ │ Оплата: Наличными                                              │ │
│ │ Комментарий: Позвонить за час до доставки                      │ │
│ │                                                                 │ │
│ │ Итого: 850₽                                                    │ │
│ │                                                                 │ │
│ │ Действия: [Подтвердить] [Начать готовить] [На доставку]        │ │
│ │           [Завершить] [Отменить] [Печать]                      │ │
│ └────────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────────┘
4. Функциональные требования
4.1. Управление заказами
Просмотр списка заказов с фильтрами и сортировкой

Быстрое изменение статуса заказа

Добавление комментариев к заказу

История изменений статусов

Массовое подтверждение/отмена заказов

Экспорт заказов в CSV/Excel

4.2. Управление меню
Древовидная структура категорий с drag-and-drop

Bulk редактирование товаров (цена, наличие)

Импорт/экспорт меню (CSV, Excel)

Быстрое управление наличием (включить/выключить товар)

Копирование товаров между категориями/ресторанами

4.3. CRM и пользователи
Сегментация пользователей по активности, количеству заказов и т.д.

Просмотр полной истории заказов пользователя

Ручное начисление/списание бонусов

Отправка персональных предложений

4.4. Аналитика
Dashboard с ключевыми метриками

Детальные отчеты с фильтрами

Экспорт отчетов

Анализ эффективности промокодов и акций

4.5. Система уведомлений
Уведомления о новых заказах (звук, браузерные уведомления)

Уведомления о критических остатках товаров

История всех уведомлений

5. Нефункциональные требования
5.1. Производительность
Загрузка списка заказов (до 1000 записей) менее 2 секунд

Real-time обновление статусов заказов

Оптимизация для работы на слабых интернет-соединениях

5.2. Безопасность
Разграничение прав доступа (роли)

Аудит действий администраторов

Защита от CSRF, XSS

HTTPS обязателен

5.3. Совместимость
Поддержка последних версий Chrome, Firefox, Safari

Адаптивный дизайн (работа на планшетах)

Поддержка темной/светлой темы браузера

6. Интеграции
6.1. С внешними сервисами
Платежные системы (для возвратов)

SMS-рассылки

Email-рассылки

Telegram-бот (для уведомлений администраторов)

6.2. С основным приложением
API для получения данных

WebSocket для real-time обновлений

Единая система аутентификации

7. Тестирование
7.1. Виды тестирования
Unit-тесты для бизнес-логики

Интеграционные тесты API

E2E тесты ключевых сценариев (Cypress)

Тестирование производительности

7.2. Критические сценарии
Оформление заказа от лица администратора

Массовое редактирование товаров

Создание и отправка рассылки

Генерация отчетов

Это ТЗ описывает полную функциональность админ-панели как отдельного продукта. Разработка может вестись параллельно с основным frontend приложением, но с использованием общих компонентов и стилей для сохранения консистентности.

Да, админ-панель нужно делать в отдельном ТЗ, так как это:

Совершенно другой продукт с другой аудиторией

Другая технология (обычно это отдельное Django приложение)

Разные требования к безопасности, UX и функциональности

Разные разработчики часто работают над админкой и фронтендом

Вот структура отдельного ТЗ для Django Admin Panel:

ТЕХНИЧЕСКОЕ ЗАДАНИЕ: Django Admin Panel для системы ресторанов
1. Общее описание
1.1. Назначение
Полнофункциональная административная панель для управления всеми аспектами системы:

Рестораны, филиалы, меню

Заказы, пользователи, аналитика

Промоакции, рассылки, бонусы

Настройки и конфигурация

1.2. Целевая аудитория
Супер-администраторы (владельцы системы)

Администраторы ресторанов

Менеджеры заказов

Контент-менеджеры

Маркетологи

2. Архитектура и технологии
2.1. Backend
Django 4.x + Django Admin

Django REST Framework для кастомных API

PostgreSQL с PostGIS для геоданных

Redis для кеширования

Celery для фоновых задач

2.2. Frontend (в рамках админки)
Django Templates (Jinja2)

Bootstrap 5 или Tailwind CSS

Chart.js для графиков

DataTables для таблиц

Select2 для улучшенных селекторов

3. МОДЕЛИ БАЗЫ ДАННЫХ ДЛЯ АДМИНКИ
python
# Модели уже описаны в основном ТЗ, но добавляем специфичные для админки:

class AdminAuditLog(models.Model):
    """Логи действий администраторов"""
    admin = models.ForeignKey(User, on_delete=models.SET_NULL, null=True)
    action = models.CharField(max_length=255)
    model = models.CharField(max_length=100)
    object_id = models.CharField(max_length=100)
    changes = models.JSONField()
    ip_address = models.GenericIPAddressField()
    timestamp = models.DateTimeField(auto_now_add=True)

class SystemSetting(models.Model):
    """Глобальные настройки системы"""
    key = models.CharField(max_length=100, unique=True)
    value = models.TextField()
    description = models.TextField(blank=True)
    is_public = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
    updated_at = models.DateTimeField(auto_now=True)

class AdminNotification(models.Model):
    """Уведомления для администраторов"""
    admin = models.ForeignKey(User, on_delete=models.CASCADE)
    title = models.CharField(max_length=255)
    message = models.TextField()
    notification_type = models.CharField(max_length=50, choices=[
        ('order', 'Новый заказ'),
        ('user', 'Новый пользователь'),
        ('warning', 'Предупреждение'),
        ('info', 'Информация')
    ])
    is_read = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
4. ОСНОВНЫЕ РАЗДЕЛЫ АДМИН-ПАНЕЛИ
4.1. Дашборд (Dashboard)
text
┌─────────────────────────────────────────────────────────────┐
│ 🏠 Дашборд │ 📦 Заказы │ 🍔 Меню │ 👥 Клиенты │ 📊 Аналитика │
├─────────────────────────────────────────────────────────────┤
│  Статистика за сегодня                                      │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐          │
│  │ 150         │ │ 75,000₽     │ │ 12          │          │
│  │  Заказов    │ │  Выручка    │ │  Новых кли. │          │
│  └─────────────┘ └─────────────┘ └─────────────┘          │
│                                                            │
│  График выручки за неделю                                  │
│  ┌─────────────────────────────────────────────────────┐  │
│  │                                                     │  │
│  │                    [График]                        │  │
│  │                                                     │  │
│  └─────────────────────────────────────────────────────┘  │
│                                                            │
│  Последние заказы                    Популярные товары    │
│  ┌─────────────────────────────┐ ┌─────────────────────┐│
│  │ #001234 • 1250₽ • Доставка  │ │ 1. Пицца Маргарита  ││
│  │ #001233 • 850₽ • Самовывоз  │ │ 2. Бургер Чизбургер ││
│  │ #001232 • 2100₽ • Доставка  │ │ 3. Кофе Латте       ││
│  └─────────────────────────────┘ └─────────────────────┘│
│                                                            │
│  Быстрые действия                                         │
│  [ + Новый заказ ] [ + Новый товар ] [ Рассылка ]        │
└─────────────────────────────────────────────────────────────┘
4.2. Управление ресторанами
Список ресторанов:

Поиск по названию, городу

Фильтры: статус, верификация

Статистика по каждому ресторану (заказы, выручка)

Форма редактирования ресторана:

python
@admin.register(Restaurant)
class RestaurantAdmin(admin.ModelAdmin):
    list_display = ['name', 'city', 'status', 'branch_count', 'order_count', 'total_revenue']
    list_filter = ['status', 'city', 'created_at']
    search_fields = ['name', 'description', 'contact_email']
    fieldsets = (
        ('Основная информация', {
            'fields': ('name', 'slug', 'description', 'logo', 'cover_image')
        }),
        ('Контактная информация', {
            'fields': ('contact_phone', 'contact_email', 'website')
        }),
        ('Юридическая информация', {
            'fields': ('legal_name', 'inn', 'kpp', 'legal_address')
        }),
        ('Настройки', {
            'fields': ('timezone', 'currency', 'language', 'managers')
        }),
        ('Статус', {
            'fields': ('status', 'is_featured', 'verification_status')
        }),
    )
    inlines = [BranchInline]
4.3. Управление меню и товарами
Категории:

Древовидная структура

Drag & drop для изменения порядка

Настройки отображения

Товары:

python
@admin.register(Product)
class ProductAdmin(admin.ModelAdmin):
    list_display = [
        'name', 'restaurant', 'category', 'price',
        'is_available', 'stock_status', 'order_count'
    ]
    list_filter = ['restaurant', 'category', 'is_available', 'tags']
    search_fields = ['name', 'description', 'sku']
    list_editable = ['price', 'is_available']
    filter_horizontal = ['tags', 'options']

    fieldsets = (
        ('Основная информация', {
            'fields': ('restaurant', 'category', 'name', 'description', 'sku')
        }),
        ('Цена и наличие', {
            'fields': ('price', 'old_price', 'cost_price', 'is_available', 'stock_quantity')
        }),
        ('Изображения', {
            'fields': ('main_image', 'image_gallery')
        }),
        ('Характеристики', {
            'fields': ('weight', 'calories', 'cooking_time')
        }),
        ('Теги и опции', {
            'fields': ('tags', 'options')
        }),
        ('SEO', {
            'fields': ('meta_title', 'meta_description', 'meta_keywords'),
            'classes': ('collapse',)
        }),
    )

    def stock_status(self, obj):
        if obj.is_available:
            return format_html('<span style="color: green;">✓ В наличии</span>')
        return format_html('<span style="color: red;">✗ Нет в наличии</span>')
4.4. Управление заказами
Список заказов с фильтрами:

По статусу (все, новые, в обработке, выполненные, отмененные)

По типу (доставка/самовывоз)

По дате

По ресторану

По сумме

Детальная страница заказа:

text
┌─────────────────────────────────────────────────────────────┐
│ Заказ #ORD-2024-001234                                      │
├─────────────────────────────────────────────────────────────┤
│ Статус: [Выберите статус ▼]                                 │
│   ○ Новый ○ Подтвержден ○ Готовится ○ В пути ○ Выполнен    │
├─────────────────────────────────────────────────────────────┤
│ Информация о клиенте:                                       │
│   Иван Иванов (@ivanov) • +7 (999) 123-45-67                │
│   Заказов: 12 • Общая сумма: 25,000₽                        │
├─────────────────────────────────────────────────────────────┤
│ Состав заказа:                                              │
│   ┌─────────────────────────────────────────────────────┐  │
│   │ Пицца Маргарита ×1                        550₽     │  │
│   │   - Размер: 30см                                   │  │
│   │   - Дополнительно: сырный бортик                  │  │
│   │ Кофе латте ×2                             300₽     │  │
│   │   - Молоко: кокосовое                         │  │
│   └─────────────────────────────────────────────────────┘  │
├─────────────────────────────────────────────────────────────┤
│ Доставка: ул. Примерная, 10, кв. 25                         │
│ Время: 18:30-18:45 • Курьер: Иван (+7 999 123-45-67)        │
├─────────────────────────────────────────────────────────────┤
│ Оплата: Наличными • Статус оплаты: [Оплачено]              │
│ Комментарий: Позвонить за час до доставки                   │
├─────────────────────────────────────────────────────────────┤
│ Итого: 850₽                                                 │
├─────────────────────────────────────────────────────────────┤
│ [ Сохранить ] [ Отменить заказ ] [ Печать ] [ Дублировать ] │
└─────────────────────────────────────────────────────────────┘
4.5. Клиентская база (CRM)
Список пользователей:

python
@admin.register(User)
class UserAdmin(admin.ModelAdmin):
    list_display = [
        'telegram_id', 'username', 'first_name', 'phone',
        'registration_date', 'order_count', 'total_spent',
        'bonus_balance', 'is_active'
    ]
    list_filter = ['is_active', 'registration_date', 'last_activity']
    search_fields = ['telegram_id', 'username', 'first_name', 'phone', 'email']
    readonly_fields = ['registration_date', 'last_activity', 'total_spent']

    fieldsets = (
        ('Telegram данные', {
            'fields': ('telegram_id', 'username', 'first_name', 'last_name')
        }),
        ('Контактная информация', {
            'fields': ('phone', 'email', 'phone_verified', 'email_verified')
        }),
        ('Статистика', {
            'fields': ('order_count', 'total_spent', 'bonus_balance')
        }),
        ('Реферальная система', {
            'fields': ('referral_code', 'referred_by', 'referral_count')
        }),
        ('Настройки', {
            'fields': ('notification_settings',)
        }),
        ('Статус', {
            'fields': ('is_active', 'is_blocked')
        }),
    )

    inlines = [OrderInline, BonusTransactionInline]

    actions = ['export_users_csv', 'send_bulk_message', 'activate_users', 'deactivate_users']
4.6. Рассылки
Создание рассылки:

text
┌─────────────────────────────────────────────────────────────┐
│ Новая рассылка                                              │
├─────────────────────────────────────────────────────────────┤
│ Название: [Акция на пиццу!                ]                │
│ Канал: [ Telegram ] [ Email ] [ SMS ]                      │
├─────────────────────────────────────────────────────────────┤
│ Получатели:                                                 │
│   [x] Все пользователи                                      │
│   [ ] Только активные (заказ за 30 дней)                   │
│   [ ] Только новые (регистрация за 7 дней)                 │
│   [ ] Только с бонусами > 100                              │
│   [ ] Кастомный список: [Выбрать пользователей...]         │
├─────────────────────────────────────────────────────────────┤
│ Сообщение:                                                  │
│   Заголовок: [Скидка 20% на всю пиццу!]                    │
│   Текст: [Дорогие друзья! Специально для вас...          ] │
│   [Добавить изображение] [Добавить кнопку]                 │
├─────────────────────────────────────────────────────────────┤
│ Время отправки:                                             │
│   [x] Отправить сейчас                                      │
│   [ ] Запланировать на: [ 2024-01-20 18:00 ]              │
├─────────────────────────────────────────────────────────────┤
│ [ Предпросмотр ] [ Тестовая отправка ] [ Создать рассылку ] │
└─────────────────────────────────────────────────────────────┘
4.7. Бонусная система
Настройка правил начисления:

python
@admin.register(BonusRule)
class BonusRuleAdmin(admin.ModelAdmin):
    list_display = ['name', 'rule_type', 'bonus_amount', 'is_active', 'used_count']
    list_filter = ['rule_type', 'is_active']

    fieldsets = (
        ('Основная информация', {
            'fields': ('name', 'description', 'rule_type')
        }),
        ('Условия', {
            'fields': ('conditions',)
        }),
        ('Вознаграждение', {
            'fields': ('bonus_amount', 'bonus_type')
        }),
        ('Ограничения', {
            'fields': ('max_uses_per_user', 'total_max_uses', 'valid_from', 'valid_to')
        }),
        ('Статус', {
            'fields': ('is_active', 'priority')
        }),
    )
Типы правил:

Регистрация - начисление при регистрации

Первый заказ - бонусы за первый заказ

За количество заказов - например, за каждые 5 заказов

За сумму покупок - бонусы за общую сумму

День рождения - персональная акция

Реферальная программа - за приглашенных друзей

4.8. Кешбек система
Настройки кешбека:

text
┌─────────────────────────────────────────────────────────────┐
│ Настройки кешбека                                           │
├─────────────────────────────────────────────────────────────┤
│ Включить кешбек: [x]                                        │
│                                                             │
│ Процент кешбека: [ 5 % ]                                    │
│                                                             │
│ Минимальная сумма заказа для кешбека: [ 500 ₽ ]             │
│                                                             │
│ Максимальный кешбек за заказ: [ 500 ₽ ]                    │
│                                                             │
│ Исключить категории: [Выбрать...]                           │
│   - Напитки                                                 │
│   - Соусы                                                   │
│                                                             │
│ Исключить товары: [Выбрать...]                              │
│                                                             │
│ [ Сохранить настройки ]                                     │
└─────────────────────────────────────────────────────────────┘
4.9. Аналитика и отчеты
Дашборд аналитики:

Графики выручки по дням/неделям/месяцам

Топ товаров/категорий/ресторанов

Конверсия (просмотры → добавления в корзину → заказы)

Средний чек

Удержание клиентов

Отчеты:

Отчет по продажам (детализация по товарам)

Отчет по клиентам (активность, LTV)

Отчет по промокодам (эффективность)

Отчет по доставке (время, стоимость)

Финансовый отчет (выручка, расходы, прибыль)

4.10. Ордеры (детальное представление)
Поля ордера в админке:

python
class OrderAdmin(admin.ModelAdmin):
    readonly_fields = [
        'created_at', 'updated_at', 'order_number',
        'total_amount', 'bonus_earned'
    ]

    fieldsets = (
        ('Основная информация', {
            'fields': ('order_number', 'user', 'restaurant_branch', 'status')
        }),
        ('Детали заказа', {
            'fields': ('items_display', 'subtotal', 'delivery_fee', 'total_amount'),
            'classes': ('collapse',)
        }),
        ('Информация о клиенте', {
            'fields': ('customer_name', 'customer_phone', 'customer_email', 'customer_comment')
        }),
        ('Доставка/Самовывоз', {
            'fields': ('delivery_address', 'delivery_time', 'courier_info')
        }),
        ('Оплата', {
            'fields': ('payment_method', 'payment_status', 'payment_id')
        }),
        ('Бонусы и скидки', {
            'fields': ('bonus_used', 'bonus_earned', 'promo_code', 'discount_amount')
        }),
        ('Системная информация', {
            'fields': ('created_at', 'updated_at', 'source', 'ip_address'),
            'classes': ('collapse',)
        }),
    )

    def items_display(self, obj):
        # Кастомное отображение товаров
        items_html = "<ul>"
        for item in obj.items.all():
            items_html += f"<li>{item.product_name} × {item.quantity} = {item.subtotal}₽</li>"
        items_html += "</ul>"
        return format_html(items_html)
5. СПЕЦИАЛЬНЫЕ ВОЗМОЖНОСТИ АДМИНКИ
5.1. Массовые операции
Массовое изменение цены товаров

Массовое включение/выключение товаров

Массовая отправка уведомлений

Массовый экспорт данных

5.2. Импорт/Экспорт
Импорт товаров из CSV/Excel

Экспорт заказов в Excel

Импорт пользователей

Экспорт отчетов в PDF

5.3. Кастомные действия
python
class CustomAdminActions:
    @action(description='Подтвердить выбранные заказы')
    def confirm_orders(self, request, queryset):
        updated = queryset.filter(status='pending').update(status='confirmed')
        self.message_user(request, f'{updated} заказов подтверждено')

    @action(description='Отправить промо-сообщение')
    def send_promo_message(self, request, queryset):
        # Показываем форму для ввода сообщения
        if 'apply' in request.POST:
            message = request.POST.get('message')
            for user in queryset:
                send_telegram_message(user.telegram_id, message)
            self.message_user(request, f'Сообщения отправлены {queryset.count()} пользователям')
        else:
            return render(request, 'admin/send_message_form.html', {'users': queryset})
6. ТРЕБОВАНИЯ К БЕЗОПАСНОСТИ
6.1. Аутентификация и авторизация
Django Allauth или кастомная аутентификация

JWT токены для API

Two-Factor Authentication для администраторов

Session timeout (30 минут неактивности)

6.2. Разграничение прав (RBAC)
python
# Пример ролей:
ROLES = {
    'superadmin': {
        'permissions': ['*']
    },
    'restaurant_admin': {
        'permissions': [
            'view_order', 'change_order',
            'view_product', 'change_product',
            'view_user'
        ],
        'restrictions': {
            'restaurant': 'own'  # Только свой ресторан
        }
    },
    'content_manager': {
        'permissions': [
            'view_product', 'change_product',
            'view_category', 'change_category'
        ]
    },
    'order_manager': {
        'permissions': [
            'view_order', 'change_order',
            'view_user'
        ]
    }
}
6.3. Аудит действий
Логирование всех действий администраторов

История изменений для важных объектов (заказы, товары)

Восстановление удаленных объектов (soft delete)

7. ПРОИЗВОДИТЕЛЬНОСТЬ И МАСШТАБИРУЕМОСТЬ
7.1. Оптимизация
Database indexing для часто используемых полей

Query optimization (select_related, prefetch_related)

Caching часто запрашиваемых данных

Pagination для больших списков

7.2. Мониторинг
Health checks для всех сервисов

Error tracking (Sentry)

Performance monitoring (New Relic, Datadog)

Log aggregation (ELK Stack)

8. ИНТЕГРАЦИИ
8.1. Внешние сервисы
Платежные системы для возвратов

SMS-сервисы для рассылок

Email-сервисы для рассылок

Telegram API для уведомлений

8.2. Внутренние интеграции
API для мобильного приложения (если будет)

Интеграция с кассовыми системами

Интеграция с системами доставки

9. ДЕПЛОЙ И ИНФРАСТРУКТУРА
9.1. Требования к серверу
Python 3.10+

PostgreSQL 14+ с PostGIS

Redis 6+

Nginx для статики

Gunicorn/Uvicorn для Django

9.2. Резервное копирование
Ежедневное backup базы данных

Backup медиафайлов

Восстановление из backup за 1 час

Это отдельное ТЗ для админ-панели. Разработка может вестись параллельно с основным фронтендом.
